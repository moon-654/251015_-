# 자동차 이미지 퀴즈 앱 설계서

## 1. 프로젝트 개요
- **목표**: `car_picker/data` 폴더에 있는 차량 이미지를 기반으로, 제조사·모델·연식을 맞추는 퀴즈 애플리케이션 구현.
- **플랫폼**: Python 기반 Streamlit 싱글 페이지 앱.
- **특징**:
  - 매 라운드 랜덤 이미지 제시 및 10지 보기 제공.
  - 사용자 지정 문제 수(기본 5문항, 최대 10문항).
  - 세션 결과를 영구 저장하여 기록 관리.

## 2. 데이터 구조 이해
- 이미지 파일명 예시: `Acura_ILX_2013_28_16_110_15_4_70_55_179_39_FWD_5_4_4dr_aWg.jpg`
- **파싱 규칙(스크래퍼 README 기반)**:
  - 앞 3개의 토큰: `제조사(Make)`, `모델(Model)`, `연식(Year)`.
  - 이후 토큰은 트림, 엔진, 구동 방식, 도어 수 등 상세 옵션을 포함.
  - 마지막 토큰은 스크래퍼가 부여한 해시/무작위 식별자.
- **파싱 전략**:
  1. 파일명을 `'_'`로 분리.
  2. `tokens[0]` → 제조사, `tokens[1]` → 모델, `tokens[2]` → 연식(정수 변환).
  3. 나머지 토큰 중 주요 필드는 필요 시 추가 메타데이터로 저장(예: `Drivetrain`, `Doors`).
  4. `label_display = "{제조사} {모델} {연식}"` 규칙으로 퀴즈 정답 문자열 구성.
  5. 파싱 결과를 DataFrame으로 적재 후 캐시 파일(`cache/car_metadata.json`)로 저장하여 초기화 비용 최소화.

## 3. 주요 기능 요구사항
1. **문제 수 설정**  
   - 홈 화면에서 사용자 입력으로 5~10문항 사이 선택. (기본값 5)
2. **난이도 옵션**  
   - 필수 요구사항: 난이도 선택 기능 제공.
   - 제안:
     - 쉽게: 제조사만 맞히기.
     - 보통: 제조사+모델.
     - 어렵게: 제조사+모델+연식.
3. **결과 저장 및 기록**  
   - 각 세션 결과(날짜, 난이도, 문제 수, 정답 수, 소요 시간 등)를 로컬 DB에 저장.
   - 구현안: `sqlite3` DB (`data/results.db`) 활용. 필요 시 CSV로 Export 옵션 추가.
4. **퀴즈 진행**  
   - 한 문제당 보기 10개(정답 1 + 오답 9), 보기 순서는 무작위.
   - 정답 제출 후 즉시 피드백 제공, 다음 문제로 이동.
5. **결과 요약 화면**  
   - 총점, 정답률, 문제별 정오답 내역, 최고 점수 비교.
   - 저장된 히스토리를 불러와 테이블/그래프 형태로 제공.

## 4. 시스템 아키텍처
```
car_picker/
├── app.py                  # Streamlit 엔트리 포인트
├── data/                   # 이미지 및 원본 데이터
├── cache/
│   └── car_metadata.json   # 파싱된 메타데이터 캐시
├── src/
│   ├── __init__.py
│   ├── data_loader.py      # 파일명 파싱, 데이터프레임 생성, 캐시 로직
│   ├── quiz_engine.py      # 문제 생성, 보기 구성, 세션 상태 관리 헬퍼
│   ├── storage.py          # 결과 저장/조회 SQLite 래퍼
│   ├── ui_components.py    # UI 구성요소(페이지, 컴포넌트) 모듈화
│   └── utils.py            # 공통 함수(난이도 매핑 등)
├── assets/
│   └── styles.css          # 커스텀 스타일
├── tests/
│   ├── test_data_loader.py
│   ├── test_quiz_engine.py
│   └── test_storage.py
└── README.md               # 실행 방법 및 소개 (최종 작성 예정)
```

## 5. 데이터 로딩 & 캐싱 흐름
1. 앱 실행 시 `cache/car_metadata.json` 존재 여부 확인.
2. 미존재 또는 `--rebuild-cache` 옵션 시:
   - `data_loader.parse_metadata()` 호출 → DataFrame 생성.
   - JSON 또는 Pickle로 캐시 저장.
3. 존재 시 캐시 파일을 로드하여 DataFrame 재구성.
4. DataFrame 컬럼 예시:
   - `id` (UUID/파일명 기반 해시)
   - `image_path`
   - `make`
   - `model`
   - `year`
   - `drivetrain`
   - `doors`
   - `label_display`

## 6. 퀴즈 엔진 설계
- **질문 풀 구성**: 사용자가 선택한 난이도·필터를 반영해 DataFrame에서 샘플링. 이미 출제된 이미지는 제외.
- **보기 생성 알고리즘**:
  1. 정답 항목 선택.
  2. 동일 제조사 또는 동일 모델에서 우선 오답 후보 확보.
  3. 부족하면 전체 데이터에서 랜덤 보충.
  4. 정답 포함 10개 리스트 생성 후 무작위 셔플.
- **세션 상태** (`st.session_state` 활용):
  - `questions`: 샘플링된 이미지와 보기 정보 리스트.
  - `current_index`: 현재 문제 번호.
  - `score`: 정답 개수.
  - `history`: 각 문제의 선택/정답 여부 기록.
- **채점 로직**: 사용자가 선택한 보기와 정답 비교 → 즉시 피드백 및 `history` 업데이트.

## 7. UI/UX 구성
- **페이지 흐름**
  1. 홈: 게임 설명, 문제 수 슬라이더(5~10), 난이도 드롭다운, 시작 버튼.
  2. 퀴즈: 이미지, 보기 버튼 10개(2열 x 5행 레이아웃 권장), 현재 점수, 남은 문제 수.
  3. 결과: 총점, 정답률, 문제별 리포트 테이블, 재시작 버튼, 기록 조회 섹션.
- **추천 컬러 팔레트**
  - 기본 배경: `#0E1117` (딥 그레이)  
  - 카드/패널: `#1F2933`  
  - 포인트: `#F0544F` (정답 강조), `#3B82F6` (버튼/링크)  
  - 텍스트: `#E5E7EB`  
  - 정오답 배경: 정답 `#14532D`, 오답 `#7F1D1D`
- **언어/라벨**: 모든 텍스트는 한국어. 예) “정답입니다!”, “다음 문제”, “최고 기록”.
- **반응형 고려**: 이미지 너비를 컬럼 폭에 맞추고, 모바일에서는 보기 버튼을 단일 열로 표시.

## 8. 결과 저장 설계
- **DB 스키마 (SQLite)**
  ```
  Table: quiz_results
    - id (INTEGER PRIMARY KEY AUTOINCREMENT)
    - played_at (TIMESTAMP)
    - num_questions (INTEGER)
    - difficulty (TEXT)
    - correct_count (INTEGER)
    - duration_seconds (INTEGER, nullable)
    - accuracy (REAL)
  ```
- 세션 종료 시 레코드 추가.
- 히스토리 조회 기능: 최근 10회 기록 테이블, 최고 점수, 평균 점수 등.
- CSV 내보내기: Streamlit 다운로드 버튼 활용.

## 9. 실행 계획 (개발 단계)
1. **데이터 파서 & 캐시**  
   - `data_loader.py` 구현 및 테스트 작성.
2. **퀴즈 엔진**  
   - 질문 생성, 보기 생성, 채점 로직 함수화 → 단위 테스트.
3. **저장소 모듈**  
   - SQLite 초기화/삽입/조회 함수 구현.
4. **UI 구축**  
   - Streamlit 페이지 구성, 세션 상태 연결.
   - CSS 적용 및 한글 텍스트 정리.
5. **결과 처리**  
   - 세션 종료 시 DB 저장, 히스토리 뷰.
6. **문서화 & 실행 가이드**  
   - `README.md` 업데이트(환경 설정, 실행 명령, 옵션 안내).
7. **최종 점검**  
   - 수동 테스트(문제 수 선택, 난이도, 기록 저장) 수행.

## 10. 향후 확장 아이디어
- 사용자 계정 시스템 및 원격 DB 연동.
- 이미지 유사도 기반 오답 추천(예: 같은 차종 색상만 다른 차량).
- 다국어 지원(영어/한국어 전환).
- 타이머 모드(제한 시간 내 정답 입력).
- 여러 명이 동시에 참여하는 멀티플레이 랭킹.

---
추가 요구사항이나 선호 UI 요소가 생기면 알려주세요. 다음 단계는 위 설계에 맞춰 코드 구현과 실행 방법 문서를 작성하는 것입니다.
